<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FoxWebChat + Admin</title>
<style>
:root {
  --bg-light: #f0f2f5;
  --chat-light: #fff;
  --text-light: #000;
  --bg-dark: #181818;
  --chat-dark: #242424;
  --text-dark: #fff;
}
body { font-family: Arial; background: var(--bg-light); display:flex; justify-content:center; padding-top:20px; transition: background 0.3s;}
#chat { width:550px; max-width:95%; height:700px; background: var(--chat-light); padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.2); display:flex; flex-direction:column; transition: background 0.3s, color 0.3s;}
#messages { flex:1; overflow-y:auto; border:1px solid #ddd; padding:10px; margin-bottom:10px; background:#f9f9f9; border-radius:5px;}
.message { margin-bottom:8px; padding:4px 6px; border-radius:4px;}
.systemMessage { color:red; font-weight:bold;}
button { padding:5px 10px; margin-left:5px; border-radius:4px; border:none; cursor:pointer;}
#namePrompt { margin-bottom:10px;}
.reportButton { background-color:#f44336; color:white;}
.reportButton:hover { background-color:#d32f2f;}
#modeBtn { margin-bottom:10px; background:#555; color:white;}
input[type="text"] { width:calc(100% - 90px); padding:8px; border-radius:4px; border:1px solid #ccc; margin-bottom:5px;}
#emojiPicker { margin-bottom:10px; }
.emojiBtn { cursor:pointer; border:none; background:none; font-size:20px; margin:2px;}
#adminPanel { display:none; margin-top:10px; border:1px solid #888; padding:10px; border-radius:5px; max-height:200px; overflow-y:auto; background:#eee;}
.reportItem { margin-bottom:5px; border-bottom:1px solid #ccc; padding-bottom:5px;}
.resolveBtn { background:#4CAF50; color:white; border:none; padding:3px 6px; cursor:pointer; margin-left:5px;}
.resolveBtn:hover { background:#45a049; }
</style>
</head>
<body>

<div id="chat">
<h2>FoxWebChat</h2>
<button id="modeBtn">Dark Mode</button>

<div id="namePrompt">
<input type="text" id="usernameInput" placeholder="Dein Name">
<button id="nameBtn">Name setzen</button>
</div>

<div id="messages"></div>

<div id="emojiPicker"></div>
<input type="text" id="input" placeholder="Schreib was..." disabled>
<button id="sendBtn" disabled>Senden</button>

<div id="adminPanel"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBMTDTFJ9DXOlABwhnJGZ-YxwVKJneazY4",
  authDomain: "foxwebchat.firebaseapp.com",
  databaseURL: "https://foxwebchat-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "foxwebchat",
  storageBucket: "foxwebchat.firebasestorage.app",
  messagingSenderId: "1083591512876",
  appId: "1:1083591512876:web:d9d1793855780d3d0fd289"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const messages = document.getElementById('messages');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');
  const usernameInput = document.getElementById('usernameInput');
  const nameBtn = document.getElementById('nameBtn');
  const modeBtn = document.getElementById('modeBtn');
  const emojiPicker = document.getElementById('emojiPicker');
  const adminPanel = document.getElementById('adminPanel');

  let username = "";
  let isAdmin = false;
  let darkMode = false;

  // Emoji-Picker
  const emojis = ['üòÑ','üòÇ','üòç','üëç','üôè','üòé','ü§î','üò¢','üéâ','üî•'];
  emojis.forEach(e => {
    const btn = document.createElement('button');
    btn.textContent = e;
    btn.className = 'emojiBtn';
    btn.addEventListener('click', () => input.value += e);
    emojiPicker.appendChild(btn);
  });

  // Dark/Light Mode
  modeBtn.addEventListener('click', () => {
    darkMode = !darkMode;
    document.body.style.background = darkMode ? '#181818' : '#f0f2f5';
    document.getElementById('chat').style.background = darkMode ? '#242424' : '#fff';
    document.getElementById('chat').style.color = darkMode ? '#fff' : '#000';
    modeBtn.textContent = darkMode ? "Light Mode" : "Dark Mode";
  });

  // Name setzen
  nameBtn.addEventListener('click', () => {
    const name = usernameInput.value.trim();
    if(!name) return alert("Bitte gib einen Namen ein!");
    username = name;
    usernameInput.disabled = true;
    nameBtn.disabled = true;
    input.disabled = false;
    sendBtn.disabled = false;

    let sysMsg = `${username} joined`;
    let adminFlag = false;

    if(username === "AdminJs93‚Ç¨=lK") {
      sysMsg = "ADMIN JOINED !BEWARE!";
      adminFlag = true;
      isAdmin = true;
      adminPanel.style.display = "block";
      loadAdminReports();
    }

    db.ref('messages').push({
      user: 'System',
      text: sysMsg,
      time: Date.now(),
      admin: adminFlag
    });
  });

  // Senden
  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });

  function sendMessage() {
    const text = input.value.trim();
    if(!text) return;
    db.ref('messages').push({
      user: username,
      text: text,
      time: Date.now()
    });
    input.value = '';
  }

  // Live Chat
  db.ref('messages').on('child_added', snapshot => {
    const data = snapshot.val();
    const div = document.createElement('div');
    div.className = 'message';
    if(data.admin) div.className += ' systemMessage';
    div.innerHTML = `<b>${data.user}:</b> ${data.text} `;

    if(data.user !== 'System') {
      const reportBtn = document.createElement('button');
      reportBtn.textContent = "Report";
      reportBtn.className = 'reportButton';
      reportBtn.addEventListener('click', () => {
        const reason = prompt(`Grund f√ºr Report von ${data.user}:`);
        if(!reason) return;
        db.ref('reports').push({
          reportedUser: data.user,
          reportedText: data.text,
          reason,
          time: Date.now()
        });
        alert("Report gesendet!");
      });
      div.appendChild(reportBtn);
    }

    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });

  // Admin Panel
  function loadAdminReports() {
    db.ref('reports').on('child_added', snapshot => {
      const data = snapshot.val();
      const div = document.createElement('div');
      div.className = 'reportItem';
      div.innerHTML = `<b>${data.reportedUser}:</b> ${data.reportedText} <br> Grund: ${data.reason} <br> <button class="resolveBtn">Gel√∂st</button>`;
      div.querySelector('.resolveBtn').addEventListener('click', () => {
        snapshot.ref.remove();
        div.remove();
      });
      adminPanel.appendChild(div);
      adminPanel.scrollTop = adminPanel.scrollHeight;
    });
  }
});
</script>
</body>
</html>
